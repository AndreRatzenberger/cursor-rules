---
description: Manages knowledge tracking and documentation organization
globs: 
alwaysApply: true
---
# Information and Knowledge Tracking

Rule for managing knowledge assets, tracking learnings, and organizing documentation.

<rule>
name: information_tracking
filters:
  - type: event
    pattern: "knowledge_capture"
  - type: event
    pattern: "file_create"
  - type: event
    pattern: "file_change"
  - type: command
    pattern: "learn"
  - type: command
    pattern: "document"
  - type: event
    pattern: "conversation_insight"
  - type: file_change
    pattern: ".cursor/docs/*"

actions:
  - type: execute
    conditions:
      - pattern: "learn add|learning create"
    command: |
      # Generate learning ID (format: LEARN-YYYY-MM-DD-NN)
      LEARNING_DATE=$(date +%Y-%m-%d)
      LEARNING_COUNT=$(ls -1 .cursor/learnings/LEARN-${LEARNING_DATE}* 2>/dev/null | wc -l)
      LEARNING_NUM=$(printf "%02d" $((LEARNING_COUNT + 1)))
      LEARNING_ID="LEARN-${LEARNING_DATE}-${LEARNING_NUM}"
      
      # Format learning title
      LEARNING_TITLE=$(echo "$LEARNING_TITLE" | tr -d '\n' | head -c 50)
      if [ ${#LEARNING_TITLE} -gt 50 ]; then
        LEARNING_TITLE="${LEARNING_TITLE}..."
      fi
      
      # Create learnings directory if it doesn't exist
      mkdir -p .cursor/learnings
      
      # Create the learning file
      LEARNING_FILE=".cursor/learnings/${LEARNING_ID}_${LEARNING_TITLE// /_}.md"
      cat > "$LEARNING_FILE" << EOF
# ${LEARNING_TITLE}

## Learning ID
${LEARNING_ID}

## Short Description
${LEARNING_SHORT_DESC}

## Detailed Description
${LEARNING_DETAILED_DESC}

## Relevant Code Files
${LEARNING_CODE_FILES:-"- None"}

## Relevant Tasks
${LEARNING_TASKS:-"- None"}

## Relevant Specifications
${LEARNING_SPECS:-"- None"}

## Relevant Documents
${LEARNING_DOCS:-"- None"}

## Date
$(date +"%Y-%m-%d")

EOF
      
      # Update the learnings index
      mkdir -p .cursor
      LEARNINGS_INDEX=".cursor/LEARNINGS.md"
      
      # Create index file if it doesn't exist
      if [ ! -f "$LEARNINGS_INDEX" ]; then
        cat > "$LEARNINGS_INDEX" << EOF
# Learnings Index

| Learning ID | Date | Description |
|-------------|------|-------------|
EOF
      fi
      
      # Add the new learning to the index
      echo "| [${LEARNING_ID}](.cursor/learnings/${LEARNING_ID}_${LEARNING_TITLE// /_}.md) | $(date +"%Y-%m-%d") | ${LEARNING_SHORT_DESC} |" >> "$LEARNINGS_INDEX"
      
      echo "Learning created: ${LEARNING_ID} - ${LEARNING_TITLE}"
      echo "Learning file: ${LEARNING_FILE}"

  - type: execute
    conditions:
      - pattern: "document add|document create|document detect"
    command: |
      # Monitor for new files in docs directory
      if [ -z "$DOCUMENT_PATH" ]; then
        # If no specific document was referenced, check for new files
        # This could be enhanced for automatic detection
        echo "Error: No document path provided"
        exit 1
      fi
      
      # Create docs directory if it doesn't exist
      mkdir -p .cursor/docs
      
      # Only process if it's a new file
      if [ ! -f ".cursor/docs/$DOCUMENT_PATH" ]; then
        # If it's not in the docs directory, copy it
        if [[ "$DOCUMENT_PATH" != ".cursor/docs/"* ]]; then
          # Create directory structure if needed
          mkdir -p $(dirname ".cursor/docs/$DOCUMENT_PATH")
          cp "$DOCUMENT_PATH" ".cursor/docs/$DOCUMENT_PATH"
        fi
      fi
      
      # Update the documents index
      DOCUMENTS_INDEX=".cursor/DOCUMENTS.md"
      
      # Create index file if it doesn't exist
      if [ ! -f "$DOCUMENTS_INDEX" ]; then
        cat > "$DOCUMENTS_INDEX" << EOF
# Documents Index

| Document | Description | Relevant Learning |
|----------|-------------|-------------------|
EOF
      fi
      
      # Check if document already in index
      if ! grep -q "$DOCUMENT_PATH" "$DOCUMENTS_INDEX"; then
        # Create a learning for this document
        LEARNING_TITLE="Document added: $(basename "$DOCUMENT_PATH")"
        LEARNING_SHORT_DESC="New document added: $DOCUMENT_PATH"
        
        if [ -z "$DOCUMENT_DESC" ]; then
          DOCUMENT_DESC="Document contains information that may be relevant for future reference."
        fi
        
        LEARNING_DETAILED_DESC="A new document was added to the repository at $DOCUMENT_PATH. $DOCUMENT_DESC"
        LEARNING_DOCS="- $DOCUMENT_PATH"
        
        # Generate learning
        LEARNING_DATE=$(date +%Y-%m-%d)
        LEARNING_COUNT=$(ls -1 .cursor/learnings/LEARN-${LEARNING_DATE}* 2>/dev/null | wc -l)
        LEARNING_NUM=$(printf "%02d" $((LEARNING_COUNT + 1)))
        LEARNING_ID="LEARN-${LEARNING_DATE}-${LEARNING_NUM}"
        
        # Create the learning file
        mkdir -p .cursor/learnings
        LEARNING_FILE=".cursor/learnings/${LEARNING_ID}_Document_added_$(basename "$DOCUMENT_PATH" | tr -d ' ' | tr '.' '_').md"
        cat > "$LEARNING_FILE" << EOF
# Document added: $(basename "$DOCUMENT_PATH")

## Learning ID
${LEARNING_ID}

## Short Description
New document added: $DOCUMENT_PATH

## Detailed Description
A new document was added to the repository at $DOCUMENT_PATH.
$DOCUMENT_DESC

## Relevant Code Files
- None

## Relevant Tasks
- None

## Relevant Specifications
- None

## Relevant Documents
- $DOCUMENT_PATH

## Date
$(date +"%Y-%m-%d")
EOF
        
        # Add document to index with reference to the learning
        echo "| $DOCUMENT_PATH | $DOCUMENT_DESC | [${LEARNING_ID}](.cursor/learnings/${LEARNING_ID}_Document_added_$(basename "$DOCUMENT_PATH" | tr -d ' ' | tr '.' '_').md) |" >> "$DOCUMENTS_INDEX"
        
        # Add learning to learnings index
        LEARNINGS_INDEX=".cursor/LEARNINGS.md"
        if [ ! -f "$LEARNINGS_INDEX" ]; then
          cat > "$LEARNINGS_INDEX" << EOF
# Learnings Index

| Learning ID | Date | Description |
|-------------|------|-------------|
EOF
        fi
        echo "| [${LEARNING_ID}](.cursor/learnings/${LEARNING_ID}_Document_added_$(basename "$DOCUMENT_PATH" | tr -d ' ' | tr '.' '_').md) | $(date +"%Y-%m-%d") | New document added: $DOCUMENT_PATH |" >> "$LEARNINGS_INDEX"
        
        echo "Document registered: $DOCUMENT_PATH"
        echo "Learning created: ${LEARNING_ID} for document"
      else
        echo "Document already registered in the index."
      fi

  - type: react
    event: "conversation_insight"
    action: |
      # Automatically detect and capture important insights from conversations
      if [ -n "$INSIGHT_TEXT" ] && [ ${#INSIGHT_TEXT} -gt 20 ]; then
        # Generate learning ID
        LEARNING_DATE=$(date +%Y-%m-%d)
        LEARNING_COUNT=$(ls -1 .cursor/learnings/LEARN-${LEARNING_DATE}* 2>/dev/null | wc -l)
        LEARNING_NUM=$(printf "%02d" $((LEARNING_COUNT + 1)))
        LEARNING_ID="LEARN-${LEARNING_DATE}-${LEARNING_NUM}"
        
        # Create title from first line or start of insight
        LEARNING_TITLE=$(echo "$INSIGHT_TEXT" | head -n 1 | tr -d '\n' | head -c 50)
        
        # Create short description
        LEARNING_SHORT_DESC=$(echo "$INSIGHT_TEXT" | tr '\n' ' ' | head -c 100)
        if [ ${#INSIGHT_TEXT} -gt 100 ]; then
          LEARNING_SHORT_DESC="${LEARNING_SHORT_DESC}..."
        fi
        
        # Create learnings directory if it doesn't exist
        mkdir -p .cursor/learnings
        
        # Create the learning file
        LEARNING_FILE=".cursor/learnings/${LEARNING_ID}_Auto_Captured_$(echo "$LEARNING_TITLE" | tr ' ' '_' | tr -dc 'a-zA-Z0-9_-').md"
        cat > "$LEARNING_FILE" << EOF
# Auto-Captured: ${LEARNING_TITLE}

## Learning ID
${LEARNING_ID}

## Short Description
${LEARNING_SHORT_DESC}

## Detailed Description
${INSIGHT_TEXT}

## Relevant Code Files
- Auto-detected from conversation context

## Date
$(date +"%Y-%m-%d")

EOF
        
        # Update the learnings index
        LEARNINGS_INDEX=".cursor/LEARNINGS.md"
        
        # Create index file if it doesn't exist
        if [ ! -f "$LEARNINGS_INDEX" ]; then
          cat > "$LEARNINGS_INDEX" << EOF
# Learnings Index

| Learning ID | Date | Description |
|----|---|----|
EOF
        fi
        
        # Add the new learning to the index
        echo "| [${LEARNING_ID}](.cursor/learnings/${LEARNING_ID}_Auto_Captured_$(echo "$LEARNING_TITLE" | tr ' ' '_' | tr -dc 'a-zA-Z0-9_-').md) | $(date +"%Y-%m-%d") | ${LEARNING_SHORT_DESC} |" >> "$LEARNINGS_INDEX"
        
        echo "Learning automatically captured: ${LEARNING_ID}"
      fi

  - type: react
    event: "file_change"
    conditions:
      - pattern: ".cursor/docs/.*"
    action: |
      # Automatically process new documents added to docs directory
      DOCUMENT_PATH=$(echo "$FILE" | sed 's/^.cursor\/docs\///')
      
      # Skip if this is a system file or already processed
      if [[ "$DOCUMENT_PATH" == *"DOCUMENTS.md"* || "$DOCUMENT_PATH" == *"index"* ]]; then
        exit 0
      fi
      
      # Update the documents index
      DOCUMENTS_INDEX=".cursor/DOCUMENTS.md"
      
      # Create index file if it doesn't exist
      if [ ! -f "$DOCUMENTS_INDEX" ]; then
        cat > "$DOCUMENTS_INDEX" << EOF
# Documents Index

| Document | Description | Relevant Learning |
|----|----|----|
EOF
      fi
      
      # Check if document already in index
      if ! grep -q "$DOCUMENT_PATH" "$DOCUMENTS_INDEX"; then
        # Create a learning for this document
        LEARNING_TITLE="Document added: $(basename "$DOCUMENT_PATH")"
        LEARNING_SHORT_DESC="New document added: $DOCUMENT_PATH"
        
        DOCUMENT_DESC="Document contains information that may be relevant for future reference."
        # Try to extract a better description from document content
        if [ -f ".cursor/docs/$DOCUMENT_PATH" ]; then
          FIRST_PARA=$(sed -n '/^#/,/^$/p' ".cursor/docs/$DOCUMENT_PATH" | grep -v "^#" | tr '\n' ' ' | head -c 150)
          if [ -n "$FIRST_PARA" ]; then
            DOCUMENT_DESC="$FIRST_PARA..."
          fi
        fi
        
        # Generate learning
        LEARNING_DATE=$(date +%Y-%m-%d)
        LEARNING_COUNT=$(ls -1 .cursor/learnings/LEARN-${LEARNING_DATE}* 2>/dev/null | wc -l)
        LEARNING_NUM=$(printf "%02d" $((LEARNING_COUNT + 1)))
        LEARNING_ID="LEARN-${LEARNING_DATE}-${LEARNING_NUM}"
        
        # Create the learning file
        mkdir -p .cursor/learnings
        LEARNING_FILE=".cursor/learnings/${LEARNING_ID}_Document_added_$(basename "$DOCUMENT_PATH" | tr -d ' ' | tr '.' '_').md"
        cat > "$LEARNING_FILE" << EOF
# Document added: $(basename "$DOCUMENT_PATH")

## Learning ID
${LEARNING_ID}

## Short Description
New document added: $DOCUMENT_PATH

## Detailed Description
A new document was added to the repository at $DOCUMENT_PATH.
$DOCUMENT_DESC

## Relevant Code Files
- None

## Relevant Tasks
- None

## Relevant Specifications
- None

## Relevant Documents
- $DOCUMENT_PATH

## Date
$(date +"%Y-%m-%d")
EOF
        
        # Add document to index with reference to the learning
        echo "| $DOCUMENT_PATH | $DOCUMENT_DESC | [${LEARNING_ID}](.cursor/learnings/${LEARNING_ID}_Document_added_$(basename "$DOCUMENT_PATH" | tr -d ' ' | tr '.' '_').md) |" >> "$DOCUMENTS_INDEX"
        
        # Add learning to learnings index
        LEARNINGS_INDEX=".cursor/LEARNINGS.md"
        if [ ! -f "$LEARNINGS_INDEX" ]; then
          cat > "$LEARNINGS_INDEX" << EOF
# Learnings Index

| Learning ID | Date | Description |
|----|---|----|
EOF
        fi
        echo "| [${LEARNING_ID}](.cursor/learnings/${LEARNING_ID}_Document_added_$(basename "$DOCUMENT_PATH" | tr -d ' ' | tr '.' '_').md) | $(date +"%Y-%m-%d") | New document added: $DOCUMENT_PATH |" >> "$LEARNINGS_INDEX"
        
        echo "Document automatically registered: $DOCUMENT_PATH"
        echo "Learning automatically created: ${LEARNING_ID} for document"
      fi

  - type: suggest
    message: |
      ### Automatic Knowledge Management

      Knowledge is now automatically captured throughout development:

      - **Important Insights**: Identified and recorded during our conversations
      - **Documents**: Automatically processed when added to `.cursor/docs/`
      
      Both types of knowledge are indexed for easy reference:
      
      - `.cursor/LEARNINGS.md`: Catalog of all captured knowledge
      - `.cursor/DOCUMENTS.md`: Registry of all shared documents
      
      Simply place reference documents in the `.cursor/docs/` directory and they'll be automatically processed and indexed.
      
      All knowledge assets receive unique IDs, detailed metadata, and cross-references to related files.

examples:
  - input: |
      # Create a new learning
      LEARNING_TITLE="Authentication best practices"
      LEARNING_SHORT_DESC="Security patterns for JWT implementation"
      LEARNING_DETAILED_DESC="When implementing JWT authentication, we discovered that using short expiration times (15min) with refresh tokens provides the best balance of security and user experience."
      LEARNING_CODE_FILES="- src/auth/jwt.js\n- src/auth/refresh.js"
      LEARNING_TASKS="- TASK-2023-10-15-01"
      LEARNING_SPECS="- specs/auth/security.md"
    output: "Learning created: LEARN-2023-10-15-01 - Authentication best practices"

  - input: |
      # Register a document
      DOCUMENT_PATH="architecture/system-design.md"
      DOCUMENT_DESC="System architecture overview with component descriptions"
    output: "Document registered: architecture/system-design.md"

metadata:
  priority: high
  version: 1.0
</rule> 